---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import "../styles/notes.css";

// Load notes, exclude drafts, newest first
const notes = (await getCollection("notes"))
  .filter(note => !note.data.draft)
  .sort(
    (a, b) =>
      new Date(b.data.date).getTime() -
      new Date(a.data.date).getTime()
  );
---

<BaseLayout title="Notes Â· Jaya Keshava Chandra Kotha">
  <h1>Blog</h1>

  <p style="max-width: 60ch;">
    A place to record thoughts, questions, and observations as they arise. Some are technical, others are simply reflections on science, research, or the world more broadly.
  </p>

  {notes.length === 0 && (
    <p><em>No notes yet.</em></p>
  )}

  {notes.map(async (note) => {
    const { Content } = await note.render();

    return (
      <article class="note-entry">
        <div class="note-marker"></div>

        <div class="note-body">
          <div class="note-title">
            {note.data.title}
          </div>

          <div class="note-date">
            {new Date(note.data.date).toLocaleDateString(undefined, {
              year: "numeric",
              month: "short",
              day: "numeric",
            })}
          </div>

          <div class="note-content">
            <Content />
          </div>

          {note.data.tags && (
            <div class="note-tags">
              {note.data.tags.map(tag => (
                <span class="note-tag">
                  <span class="tag-icon">#</span>{tag}
                </span>
              ))}
            </div>
          )}
        </div>
      </article>
    );
  })}
</BaseLayout>
