---
import { parseStringPromise } from "xml2js";

const FEED_URL = "https://medium.com/feed/@jayakeshav.work";

// fetch RSS feed
const res = await fetch(FEED_URL);
const xml = await res.text();

// parse XML
const feed = await parseStringPromise(xml, { trim: true });

// Medium structure → items list
const items = feed.rss.channel[0].item.slice(0, 5); // show latest 5 posts
---

<section>
  <h2>Latest on Medium</h2>

  <ul style="list-style:none; padding-left:0;">
    {items.map((post) => {
      const title = post.title[0];
      const link = post.link[0];
      const date = new Date(post.pubDate[0]).toLocaleDateString(undefined, {
        year: "numeric",
        month: "short",
        day: "numeric",
      });

      // remove HTML tags from Medium content encoded
      const raw = post["content:encoded"][0]
        .replace(/<[^>]+>/g, "")
        .replace(/\s+/g, " ")
        .trim();

      const summary = raw.slice(0, 180) + "…";

      return (
        <li style="margin-bottom: 1.5rem;">
          <a href={link} target="_blank" rel="noopener" style="text-decoration:none;">
            <h3 style="margin-bottom: 0.25rem;">{title}</h3>
          </a>

          <div style="font-size:0.85rem; opacity:0.7; margin-bottom:0.25rem;">
            {date}
          </div>

          <p style="margin-top:0;">
            {summary}
          </p>

          <a href={link} target="_blank" rel="noopener">
            Read on Medium →
          </a>
        </li>
      );
    })}
  </ul>
</section>
